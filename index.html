<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spotify Music Engine</title>
    <style>
        :root {
            --bg: #121212;
            --card: #181818;
            --hover: #282828;
            --text: #ffffff;
            --subtext: #b3b3b3;
            --spotify-green: #1db954;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Helvetica Neue', 'Arial', sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding-bottom: 100px; /* Space for player */
        }

        /* --- LOGIN SCREEN --- */
        #login-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(0,0,0,0.8), #000);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 999;
            backdrop-filter: blur(5px);
        }
        .login-card {
            background: #222;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .login-btn {
            background: var(--spotify-green);
            color: black;
            padding: 15px 40px;
            border-radius: 30px;
            font-weight: 800;
            font-size: 1rem;
            border: none;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: transform 0.2s, background 0.2s;
            margin-top: 20px;
        }
        .login-btn:hover { transform: scale(1.05); background: #1ed760; }
        .dev-warning {
            color: #ed4245;
            background: rgba(237, 66, 69, 0.1);
            border: 1px solid #ed4245;
            padding: 10px;
            font-size: 0.8rem;
            margin-top: 20px;
            border-radius: 5px;
            max-width: 300px;
        }

        /* --- SEARCH BAR --- */
        .search-wrapper {
            position: sticky; top: 0;
            background: rgba(18, 18, 18, 0.95);
            width: 100%;
            padding: 20px 0;
            display: flex; justify-content: center;
            z-index: 100;
            border-bottom: 1px solid #333;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        .search-box {
            background: #fff;
            border-radius: 30px;
            padding: 12px 25px;
            display: flex;
            align-items: center;
            width: 90%;
            max-width: 600px;
        }
        input {
            border: none; outline: none;
            font-size: 1.1rem; flex-grow: 1;
            margin-left: 10px;
            font-weight: 500;
        }
        .search-icon { width: 24px; opacity: 0.5; fill: black; }

        /* --- RESULTS GRID --- */
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            width: 92%;
            max-width: 1400px;
            margin-top: 30px;
        }
        .song-card {
            background: var(--card);
            padding: 15px;
            border-radius: 8px;
            transition: background 0.2s ease;
            cursor: pointer;
            display: flex; flex-direction: column;
            align-items: center;
            text-align: left;
            position: relative;
        }
        .song-card:hover { background: var(--hover); }
        .song-card:hover .play-overlay { opacity: 1; }
        
        .album-art-wrapper { position: relative; width: 100%; margin-bottom: 15px; }
        .album-art {
            width: 100%;
            aspect-ratio: 1;
            object-fit: cover;
            border-radius: 4px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }
        .play-overlay {
            position: absolute; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.5);
            border-radius: 4px;
            display: flex; justify-content: center; align-items: center;
            opacity: 0; transition: 0.2s;
        }
        .play-icon { width: 50px; height: 50px; fill: white; filter: drop-shadow(0 0 5px rgba(0,0,0,0.5)); }

        .song-title { font-weight: bold; font-size: 1rem; width: 100%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-bottom: 5px; color: white;}
        .artist-name { color: var(--subtext); font-size: 0.9rem; width: 100%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* --- EMBED PLAYER (Fixed Bottom) --- */
        #player-container {
            position: fixed;
            bottom: 20px; left: 50%; transform: translateX(-50%) translateY(150%);
            width: 90%; max-width: 800px;
            height: 80px;
            background: #000;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.8);
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 500;
            overflow: hidden;
            border: 1px solid #333;
        }
        #player-container.active { transform: translateX(-50%) translateY(0); }
        iframe { width: 100%; height: 100%; border: none; }
        
        /* LOAD MORE */
        #load-more {
            margin: 40px;
            background: transparent;
            border: 1px solid var(--subtext);
            color: white;
            padding: 12px 40px;
            border-radius: 30px;
            cursor: pointer;
            font-weight: bold;
            letter-spacing: 1px;
            text-transform: uppercase;
        }
        #load-more:hover { border-color: white; background: rgba(255,255,255,0.1); }
        .hidden { display: none !important; }

    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-card">
            <h1 style="font-size: 2.5rem; margin: 0;">Music Explorer</h1>
            <p style="color:#aaa;">Search millions of tracks instantly.</p>
            
            <button id="login-btn" class="login-btn">Login with Spotify</button>

            <div class="dev-warning">
                <strong>⚠️ DEVELOPMENT MODE</strong><br>
                Your email MUST be added to the Spotify Dashboard "Users & Access" list, or login will fail.
            </div>
        </div>
    </div>

    <div id="main-ui" class="hidden" style="width:100%; display:flex; flex-direction:column; align-items:center;">
        
        <div class="search-wrapper">
            <div class="search-box">
                <svg class="search-icon" viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
                <input type="text" id="search-input" placeholder="Search for songs, artists, or podcasts...">
            </div>
        </div>

        <div id="results-area" class="results-grid"></div>
        <button id="load-more" class="hidden" onclick="search(true)">Load More Results</button>

    </div>

    <div id="player-container">
        <div id="embed-wrapper" style="height:100%;"></div>
    </div>

    <script>
        // --- CONFIGURATION ---
        const CLIENT_ID = '162510cddb714bdc9baa0e56878eff6d'; // YOUR ID IS HERE
        // Auto-detects the current URL (e.g. https://your-site.github.io/spotify.html)
        // Make sure this EXACT URL is in your Dashboard Redirect URIs!
        const REDIRECT_URI = window.location.href.split('#')[0]; 
        // ---------------------

        let accessToken = null;
        let nextUrl = null;

        window.onload = () => {
            // Check for token in URL hash
            const params = new URLSearchParams(window.location.hash.substring(1));
            accessToken = params.get('access_token');

            if (accessToken) {
                // SUCCESS: Logged in
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('main-ui').classList.remove('hidden');
                
                // Clear the ugly token from the address bar
                window.history.replaceState({}, document.title, window.location.pathname);
            } else {
                // SETUP LOGIN BUTTON
                document.getElementById('login-btn').onclick = () => {
                    const scopes = 'user-read-private user-read-email';
                    const authUrl = `https://accounts.spotify.com/authorize?client_id=${CLIENT_ID}&response_type=token&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&scope=${encodeURIComponent(scopes)}&show_dialog=true`;
                    window.location.href = authUrl;
                };
            }
        };

        // SEARCH LOGIC
        let debounce;
        document.getElementById('search-input').addEventListener('keyup', (e) => {
            clearTimeout(debounce);
            if (e.key === "Enter") search();
            else debounce = setTimeout(() => search(), 600);
        });

        async function search(loadMore = false) {
            const query = document.getElementById('search-input').value;
            if (!query) return;

            // Determine URL
            let url = `https://api.spotify.com/v1/search?q=${encodeURIComponent(query)}&type=track&limit=24`;
            if (loadMore && nextUrl) url = nextUrl;
            else if (!loadMore) {
                document.getElementById('results-area').innerHTML = ''; // Clear old results
                document.getElementById('load-more').classList.add('hidden');
            }

            try {
                const res = await fetch(url, { headers: { 'Authorization': 'Bearer ' + accessToken } });
                
                if (res.status === 401) {
                    alert("Login expired. Reloading...");
                    window.location.reload();
                    return;
                }

                const data = await res.json();
                nextUrl = data.tracks.next;
                
                // Show/Hide Load More Button
                if (nextUrl) document.getElementById('load-more').classList.remove('hidden');
                else document.getElementById('load-more').classList.add('hidden');

                renderTracks(data.tracks.items);

            } catch (err) {
                console.error("Search Error:", err);
            }
        }

        function renderTracks(tracks) {
            const container = document.getElementById('results-area');
            
            tracks.forEach(track => {
                const img = track.album.images[0] ? track.album.images[0].url : '';
                
                const card = document.createElement('div');
                card.className = 'song-card';
                card.innerHTML = `
                    <div class="album-art-wrapper">
                        <img src="${img}" class="album-art">
                        <div class="play-overlay">
                            <svg class="play-icon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                        </div>
                    </div>
                    <div class="song-title">${track.name}</div>
                    <div class="artist-name">${track.artists.map(a => a.name).join(', ')}</div>
                `;
                
                card.onclick = () => playTrack(track.id);
                container.appendChild(card);
            });
        }

        function playTrack(id) {
            const container = document.getElementById('player-container');
            const wrapper = document.getElementById('embed-wrapper');
            
            container.classList.add('active');
            wrapper.innerHTML = `
                <iframe src="https://open.spotify.com/embed/track/${id}?utm_source=generator&theme=0" 
                allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
            `;
        }
    </script>
</body>
</html>
